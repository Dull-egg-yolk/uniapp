(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["components/img-popup/img-popup"],{351:function(e,t,n){"use strict";n.r(t);var a=n(352),r=n(354);for(var i in r)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(i);n(357);var c,o=n(32),u=Object(o["default"])(r["default"],a["render"],a["staticRenderFns"],!1,null,"03fdd90a",null,!1,a["components"],c);u.options.__file="components/img-popup/img-popup.vue",t["default"]=u.exports},352:function(e,t,n){"use strict";n.r(t);var a=n(353);n.d(t,"render",(function(){return a["render"]})),n.d(t,"staticRenderFns",(function(){return a["staticRenderFns"]})),n.d(t,"recyclableRender",(function(){return a["recyclableRender"]})),n.d(t,"components",(function(){return a["components"]}))},353:function(e,t,n){"use strict";var a;n.r(t),n.d(t,"render",(function(){return r})),n.d(t,"staticRenderFns",(function(){return c})),n.d(t,"recyclableRender",(function(){return i})),n.d(t,"components",(function(){return a}));var r=function(){var e=this,t=e.$createElement;e._self._c},i=!1,c=[];r._withStripped=!0},354:function(e,t,n){"use strict";n.r(t);var a=n(355),r=n.n(a);for(var i in a)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(i);t["default"]=r.a},355:function(e,t,n){"use strict";(function(e,a){var r=n(4);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(43)),c=r(n(45)),o=n(188),u=n(356),s=(0,o.usePrint)(),l=s.startJob,f=s.startDrawLabel,d=(s.drawText,s.drawBarcode,s.drawQRCode,s.drawRectangle,s.drawLine,s.drawImage),p=s.endDrawLabel,v=s.print,h=s.didReadPrintCountInfo,g=s.didReadPrintErrorInfo,m=(s.getMultiple,s.getSn),w=(s.setPlatform,s.setBuildPlatform,{props:{title:{type:String,default:"图片预览"},imageUrl:{type:String,required:!0},closeOnClickMask:{type:Boolean,default:!0},imgContent:{type:String,required:!0}},data:function(){return{rqImg:"",visible:!1,saveImg:"",canvasHeight:320,canvasWidth:400}},computed:{canvasWidthResponsive:function(){return this.canvasWidth},canvasHeightResponsive:function(){return this.canvasHeight}},methods:{draw:function(){var t=this;return(0,c.default)(i.default.mark((function n(){var a;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:a=e.createSelectorQuery().in(t),a.select("#myCanvas").fields({node:!0}).exec(),a.select("#myCanvas").fields({node:!0,size:!0}).exec(function(){var n=(0,c.default)(i.default.mark((function n(a){var r,c,o,u,s,l,f,d,p;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r=a[0].node,c=r.getContext("2d"),o=a[0],u=o.width,s=o.height,l=e.getSystemInfoSync().pixelRatio,r.width=u*l,r.height=s*l,c.scale(l,l),c.setFontSize(16),c.setFillStyle("#000000"),c.setTextAlign("center"),c.fillStyle="#fff",c.fillRect(0,0,u,s),n.next=14,e.downloadFile({url:t.rqImg});case 14:f=n.sent,d=f.tempFilePath,p=r.createImage(),p.src=d,p.onload=function(){c.drawImage(p,50,30,100,100)};case 19:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}());case 3:case"end":return n.stop()}}),n)})))()},starPrint:function(){var t=this;return(0,c.default)(i.default.mark((function n(){var a,r,c,o;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:t.printed+=1,a=50,r=40,8,c="",c="myCanvas",o=e.createCanvasContext(c),t.handleLabelDrawing(c,o,a,r,0);case 8:case"end":return n.stop()}}),n)})))()},handleLabelDrawing:function(e,t,n,a,r){var o=this;return(0,c.default)(i.default.mark((function c(){var u;return i.default.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.next=2,o.generateImage();case 2:u=i.sent,f(e,o,n,a,r,t),d(u,0,3,50,40),p((function(){console.log("打印完成"),setTimeout((function(){o.close()}),500),v(1,(function(){o.quantity>o.printed&&o.starPrint()}))}));case 6:case"end":return i.stop()}}),c)})))()},drawCanvas:function(){var t=this;return(0,c.default)(i.default.mark((function n(){var a;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,(0,u.base64ToTempPath)("data:image/png;base64,".concat(t.imageUrl));case 2:return a=n.sent,n.abrupt("return",new Promise((function(n){var r=e.createCanvasContext("myCanvas",t);r.drawImage(a,40,20,220,220),r.setFontSize(20),r.setFillStyle("#000000"),r.setTextAlign("center");var i=270;r.fillText(t.imgContent,150,i),r.draw(!1,(function(){setTimeout(n,300)}))})));case 4:case"end":return n.stop()}}),n)})))()},generateImage:function(){var t=this;return(0,c.default)(i.default.mark((function n(){return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,t.drawCanvas();case 2:return n.abrupt("return",new Promise((function(n,a){e.canvasToTempFilePath({canvasId:"myCanvas",success:function(e){t.saveImg=e.tempFilePath,n(e.tempFilePath)},fail:function(e){console.error("Canvas转图片失败:",e),a(e)}},t)})));case 3:case"end":return n.stop()}}),n)})))()},getBuffer:function(){var e=this;return(0,c.default)(i.default.mark((function t(){var n;return i.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.base64ToTempPath("data:image/png;base64,".concat(e.imageUrl));case 3:return n=t.sent,e.rqImg=n,t.abrupt("return",n);case 8:t.prev=8,t.t0=t["catch"](0);case 10:case"end":return t.stop()}}),t,null,[[0,8]])})))()},base64ToTempPath:function(t){return new Promise((function(n){var r=t.split(",")[1]||t,i=e.getFileSystemManager(),c="".concat(a.env.USER_DATA_PATH,"/qrcode_").concat(Date.now(),".png");i.writeFile({filePath:c,data:r,encoding:"base64",success:function(){return n(c)}})}))},open:function(){var e=this;this.visible=!0,this.$nextTick((function(){e.getBuffer().then((function(t){e.rqImg=t,setTimeout((function(){e.generateImage()}),300)}))}))},close:function(){this.visible=!1,this.$emit("close")},handleMaskClick:function(){this.closeOnClickMask&&this.close()},handlePrint:function(){var t=this,n=getApp();e.getStorageSync("isBluetooth");if(n.globalData.bluetoothConnected){var a=0;m((function(n){-4===n.code&&(a=-4),-4!==a?(t.printed=0,e.showToast({title:"开始打印"}),h((function(e){console.log(e.count)})),g((function(e){console.log(e.errCode)})),console.log("code","4"),l(1,3,t.quantity,(function(){t.starPrint()}))):e.showToast({title:"打印机未连接",icon:"none"})}))}else e.navigateTo({url:"/pages/lian/lian"})},handleSave:function(){var t=this;return(0,c.default)(i.default.mark((function n(){var a;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,t.generateImage();case 2:a=n.sent,e.saveImageToPhotosAlbum({filePath:a,success:function(){e.showToast({title:"保存成功",icon:"success"})},fail:function(t){console.error("保存失败:",t),t.errMsg.includes("auth deny")&&e.showModal({title:"提示",content:"需要相册权限才能保存",success:function(t){t.confirm&&e.openSetting()}})}});case 4:case"end":return n.stop()}}),n)})))()}},mounted:function(){}});t.default=w}).call(this,n(2)["default"],n(1)["default"])},357:function(e,t,n){"use strict";n.r(t);var a=n(358),r=n.n(a);for(var i in a)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(i);t["default"]=r.a},358:function(e,t,n){}}]);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/components/img-popup/img-popup.js.map
;(global["webpackJsonp"] = global["webpackJsonp"] || []).push([
    'components/img-popup/img-popup-create-component',
    {
        'components/img-popup/img-popup-create-component':(function(module, exports, __webpack_require__){
            __webpack_require__('2')['createComponent'](__webpack_require__(351))
        })
    },
    [['components/img-popup/img-popup-create-component']]
]);
