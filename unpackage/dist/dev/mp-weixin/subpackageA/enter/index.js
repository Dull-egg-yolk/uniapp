require('../common/vendor.js');(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["subpackageA/enter/index"],{85:function(e,t,n){"use strict";(function(e,t){var o=n(4);n(26);o(n(25));var s=o(n(86));e.__webpack_require_UNI_MP_PLUGIN__=n,t(s.default)}).call(this,n(1)["default"],n(2)["createPage"])},86:function(e,t,n){"use strict";n.r(t);var o=n(87),s=n(89);for(var r in s)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return s[e]}))}(r);n(91);var a,i=n(32),u=Object(i["default"])(s["default"],o["render"],o["staticRenderFns"],!1,null,"789c2329",null,!1,o["components"],a);u.options.__file="subpackageA/enter/index.vue",t["default"]=u.exports},87:function(e,t,n){"use strict";n.r(t);var o=n(88);n.d(t,"render",(function(){return o["render"]})),n.d(t,"staticRenderFns",(function(){return o["staticRenderFns"]})),n.d(t,"recyclableRender",(function(){return o["recyclableRender"]})),n.d(t,"components",(function(){return o["components"]}))},88:function(e,t,n){"use strict";var o;n.r(t),n.d(t,"render",(function(){return s})),n.d(t,"staticRenderFns",(function(){return a})),n.d(t,"recyclableRender",(function(){return r})),n.d(t,"components",(function(){return o}));try{o={uniPopup:function(){return n.e("uni_modules/uni-popup/components/uni-popup/uni-popup").then(n.bind(null,369))},uniIcons:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uni-icons/components/uni-icons/uni-icons")]).then(n.bind(null,376))},imgPopup:function(){return Promise.all([n.e("common/vendor"),n.e("components/img-popup/img-popup")]).then(n.bind(null,384))}}}catch(i){if(-1===i.message.indexOf("Cannot find module")||-1===i.message.indexOf(".vue"))throw i;console.error(i.message),console.error("1. 排查组件名称拼写是否正确"),console.error("2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom"),console.error("3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件")}var s=function(){var e=this,t=e.$createElement;e._self._c},r=!1,a=[];s._withStripped=!0},89:function(e,t,n){"use strict";n.r(t);var o=n(90),s=n.n(o);for(var r in o)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(r);t["default"]=s.a},90:function(e,t,n){"use strict";(function(e,o){var s=n(4);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=s(n(43)),a=s(n(45)),i=n(73),u=n(74),c=n(46),l=function(){Promise.all([n.e("common/vendor"),n.e("components/img-popup/img-popup")]).then(function(){return resolve(n(384))}.bind(null,n)).catch(n.oe)},f={components:{imgPopup:l},data:function(){return{warehouseList:[],selectedWarehouse:"",tempSelected:"",currentItem:{},selectedWarehouseId:null,imgContent:"",warehouseName:"",scanUrl:"",title:"",DefaultWarehouseID:0,GoodsID:0,goodList:{},imageUrl:"",imagePath:"",uploadToken:"",classList:[],selectedClass:"请选择",isUpdate:!1,form:{Name:"",Uint:"",Format:"",Price:"",ClassID:"",Suppliers:"",MinStock:0,MaxStock:0,Image:"",Note:""},HotelID:0,qiniuDomain:"https://staticweb.jiudianhui.com.cn",categories:["默认分类","分类1","分类2","分类3"]}},methods:{showPopup:function(){this.tempSelected=this.selectedWarehouse,this.$refs.popup.open()},closePopup:function(){this.$refs.popup.close()},selectWarehouse:function(e){this.tempSelected=e.Name,this.selectedWarehouse=e.Name,this.selectedWarehouseId=e.ID},confirmSelection:function(){""!==this.tempSelected?(this.selectedWarehouse=this.tempSelected,console.log(this.selectedWarehouse,"确认选择"),this.closePopup(),this.getScan(),this.$emit("selected",this.selectedWarehouse)):e.showToast({title:"请选择库房",icon:"none"})},getWarehouseList:function(){var e=this;return(0,a.default)(r.default.mark((function t(){var n;return r.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,(0,u.getWarehouse)();case 2:n=t.sent,console.log(n),e.warehouseList=n.Data;case 5:case"end":return t.stop()}}),t)})))()},onClose:function(){},getHotelClassList:function(){var e=this;return(0,a.default)(r.default.mark((function t(){var n;return r.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,(0,u.getHotelClass)();case 2:n=t.sent,e.classList=n.Data;case 4:case"end":return t.stop()}}),t)})))()},getUserConfig:function(){var t=this;return(0,a.default)(r.default.mark((function n(){return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,(0,c.getUserConfig)().then((function(n){n.ErrorMsg?e.showToast({title:n.ErrorMsg,icon:"none"}):t.uploadToken=n.Data.CdnT}));case 2:n.sent;case 3:case"end":return n.stop()}}),n)})))()},chooseImage:function(){var t=this;e.chooseImage({count:1,sizeType:["compressed"],sourceType:["album","camera"],success:function(){var e=(0,a.default)(r.default.mark((function e(n){var s;return r.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.imagePath=n.tempFilePaths[0],console.log(t.imagePath,"1"),e.next=4,new Promise((function(e){o.compressImage({src:t.imagePath,quality:80,success:e,fail:function(n){console.log("压缩失败",n),e({tempFilePath:t.imagePath})}})}));case 4:s=e.sent,setTimeout((function(){t.uploadImage(s.tempFilePath,t.uploadToken)}),100);case 6:case"end":return e.stop()}}),e)})));function n(t){return e.apply(this,arguments)}return n}()})},uploadImage:function(t,n){var o=this;return new Promise((function(s,r){var a="ims/dev/goods/".concat(o.HotelID,"/").concat(Date.now(),".").concat(t.split(".").pop());e.uploadFile({url:"https://up-z1.qiniup.com",filePath:t,name:"file",header:{"Content-Type":"multipart/form-data"},formData:{token:n,key:a},success:function(e){if(200===e.statusCode){var t=JSON.parse(e.data);o.form.Image="".concat(o.qiniuDomain,"/").concat(t.key),o.imageUrl="".concat(o.qiniuDomain,"/").concat(t.key),console.log(o.form.Image,"0"),s(t)}else r(new Error("上传失败"))},fail:function(e){r(e)}})}))},submitForm:(0,i.throttle)((0,a.default)(r.default.mark((function t(){var n=this;return r.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(this.form.Price=Number(this.form.Price)||0,this.form.MinStock=Number(this.form.MinStock)||0,this.form.MaxStock=Number(this.form.MaxStock)||0,console.log((this.selectedClass,"请选择")),"请选择"===this.selectedClass?this.form.ClassID=0:this.form.ClassID=this.classList.find((function(e){return e.Name===n.selectedClass})).ID,this.form.Name){t.next=8;break}return e.showToast({title:"请填写物品名称",icon:"none"}),t.abrupt("return");case 8:if(this.form.Uint){t.next=11;break}return e.showToast({title:"请填写单位",icon:"none"}),t.abrupt("return");case 11:if(this.form.Format){t.next=14;break}return e.showToast({title:"请填写物品规格",icon:"none"}),t.abrupt("return");case 14:if("number"===typeof this.form.MinStock){t.next=17;break}return e.showToast({title:"请填写物品最小库存",icon:"none"}),t.abrupt("return");case 17:if(this.form.Image){t.next=20;break}return e.showToast({title:"请上传物品图片",icon:"none"}),t.abrupt("return");case 20:if(!this.isUpdate){t.next=25;break}return t.next=23,(0,u.updateGoodsItme)(this.form).then((function(t){t.ErrorMsg?e.showToast({title:t.ErrorMsg,icon:"none"}):(n.DefaultWarehouseID=t.Data.DefaultWarehouseID,n.GoodsID=t.Data.ID,n.goodList=t.Data,e.showToast({title:"提交成功",icon:"success"}),n.form={Name:"",Uint:"",Format:"",Price:"",ClassID:"",Suppliers:"",MinStock:"",MaxStock:"",Image:"",Note:""},n.imageUrl="",e.navigateTo({url:"/subpackageA/itemPage/index"}))}));case 23:t.next=27;break;case 25:return t.next=27,(0,u.addGoodsItme)(this.form).then((function(t){t.ErrorMsg?e.showToast({title:t.ErrorMsg,icon:"none"}):(n.DefaultWarehouseID=t.Data.DefaultWarehouseID,n.GoodsID=t.Data.ID,n.goodList=t.Data,n.warehouseName=n.selectedWarehouse,e.showToast({title:"提交成功",icon:"success"}),n.form={Name:"",Uint:"",Format:"",Price:"",ClassID:"",Suppliers:"",MinStock:"",MaxStock:"",Image:"",Note:""},n.imageUrl="",n.showPopup())}));case 27:case"end":return t.stop()}}),t,this)}))),500),onClassChange:function(e){this.selectedClass=this.classList[e.detail.value].Name},getScan:function(){var t=this;return(0,a.default)(r.default.mark((function n(){var o,s;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return o={WarehouseID:t.selectedWarehouseId,GoodsID:t.GoodsID},n.next=3,(0,u.getQrcode)(o);case 3:s=n.sent,s.ErrorMsg?e.showToast({title:s.ErrorMsg,icon:"none"}):(t.scanUrl=s.Data,t.imgContent=t.goodList.Name+" "+t.goodList.Format+"/"+t.goodList.Uint,t.$refs.imagePopup.open());case 5:case"end":return n.stop()}}),n)})))()}},mounted:function(){this.getWarehouseList(),this.getUserConfig(),this.getHotelClassList(),this.HotelID=e.getStorageSync("user_info").Hotel.ID},onUnload:function(){e.switchTab({url:"/pages/home/home"})},onLoad:function(e){var t=this;return(0,a.default)(r.default.mark((function n(){var o;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(console.log(e,"options"),"{}"!==JSON.stringify(e)){n.next=3;break}return n.abrupt("return");case 3:return n.next=5,t.getHotelClassList();case 5:o=JSON.parse(decodeURIComponent(e.form)),o&&(t.isUpdate=!0,console.log(o,"options.form"),t.form=o,t.imageUrl=o.Image,t.selectedClass=t.classList.find((function(e){return e.ID===o.ClassID})).Name);case 7:case"end":return n.stop()}}),n)})))()}};t.default=f}).call(this,n(2)["default"],n(1)["default"])},91:function(e,t,n){"use strict";n.r(t);var o=n(92),s=n.n(o);for(var r in o)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(r);t["default"]=s.a},92:function(e,t,n){}},[[85,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/subpackageA/enter/index.js.map