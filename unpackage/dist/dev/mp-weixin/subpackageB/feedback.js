require('./common/vendor.js');(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["subpackageB/feedback"],{293:function(e,t,n){"use strict";(function(e,t){var r=n(4);n(26);r(n(25));var a=r(n(294));e.__webpack_require_UNI_MP_PLUGIN__=n,t(a.default)}).call(this,n(1)["default"],n(2)["createPage"])},294:function(e,t,n){"use strict";n.r(t);var r=n(295),a=n(297);for(var o in a)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(o);n(299);var i,s=n(32),u=Object(s["default"])(a["default"],r["render"],r["staticRenderFns"],!1,null,"39141474",null,!1,r["components"],i);u.options.__file="subpackageB/feedback.vue",t["default"]=u.exports},295:function(e,t,n){"use strict";n.r(t);var r=n(296);n.d(t,"render",(function(){return r["render"]})),n.d(t,"staticRenderFns",(function(){return r["staticRenderFns"]})),n.d(t,"recyclableRender",(function(){return r["recyclableRender"]})),n.d(t,"components",(function(){return r["components"]}))},296:function(e,t,n){"use strict";var r;n.r(t),n.d(t,"render",(function(){return a})),n.d(t,"staticRenderFns",(function(){return i})),n.d(t,"recyclableRender",(function(){return o})),n.d(t,"components",(function(){return r}));try{r={uniIcons:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uni-icons/components/uni-icons/uni-icons")]).then(n.bind(null,376))}}}catch(s){if(-1===s.message.indexOf("Cannot find module")||-1===s.message.indexOf(".vue"))throw s;console.error(s.message),console.error("1. 排查组件名称拼写是否正确"),console.error("2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom"),console.error("3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件")}var a=function(){var e=this,t=e.$createElement,n=(e._self._c,e.imageList.length),r=e.uploading||0===e.imageList.length;e.$mp.data=Object.assign({},{$root:{g0:n,g1:r}})},o=!1,i=[];a._withStripped=!0},297:function(e,t,n){"use strict";n.r(t);var r=n(298),a=n.n(r);for(var o in r)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(o);t["default"]=a.a},298:function(e,t,n){"use strict";(function(e,r){var a=n(4);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=a(n(43)),i=a(n(18)),s=a(n(45)),u=n(73),c=n(46),l={components:{},data:function(){return{phone:15011499876,detail:"",images:[],form:{Telephone:"",Demand:"",Images:[]},imageList:[],maxCount:9,uploading:!1,uploadedCount:0,qiniuToken:"",qiniuDomain:"https://staticweb.jiudianhui.com.cn",compressQuality:.7,HotelID:0}},methods:{MyFeedback:function(){e.navigateTo({url:"/subpackageB/myFeedback"})},chooseImage:function(){var t=this;return(0,s.default)(o.default.mark((function n(){var r,a,u;return o.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,e.chooseImage({count:t.maxCount-t.imageList.length,sizeType:["compressed"],sourceType:["album","camera"]});case 3:return r=n.sent,console.log(r,"999999"),a=r[1].tempFilePaths.map(function(){var e=(0,s.default)(o.default.mark((function e(n){var r;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.compressImage(n);case 2:return r=e.sent,e.abrupt("return",{tempPath:r.tempFilePath,file:r.tempFile,progress:0,key:""});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),n.next=8,Promise.all(a);case 8:u=n.sent,t.imageList=[].concat((0,i.default)(t.imageList),(0,i.default)(u)),n.next=16;break;case 12:n.prev=12,n.t0=n["catch"](0),console.error("选择图片失败:",n.t0),e.showToast({title:"选择图片失败",icon:"none"});case 16:case"end":return n.stop()}}),n,null,[[0,12]])})))()},compressImage:function(e){var t=this;return new Promise((function(n,a){r.compressImage({src:e,quality:100*t.compressQuality,success:n,fail:a})}))},deleteImage:function(t){var n=this;e.showModal({title:"提示",content:"确定删除这张图片吗？",success:function(e){e.confirm&&(n.imageList.splice(t,1),n.uploadedCount=Math.max(0,n.uploadedCount-1))}})},previewImage:function(t){e.previewImage({current:t,urls:this.imageList.map((function(e){return e.tempPath}))})},getToken:function(){var t=this;return(0,s.default)(o.default.mark((function n(){var r;return o.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,(0,c.getUserConfig)();case 3:return r=n.sent,t.qiniuToken=r.Data.CdnT,n.abrupt("return",!0);case 8:return n.prev=8,n.t0=n["catch"](0),e.showToast({title:"获取上传凭证失败",icon:"none"}),n.abrupt("return",!1);case 12:case"end":return n.stop()}}),n,null,[[0,8]])})))()},uploadImages:(0,u.throttle)((0,s.default)(o.default.mark((function t(){var n,r=this;return o.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(t.t0=!this.qiniuToken,!t.t0){t.next=5;break}return t.next=4,this.getToken();case 4:t.t0=!t.sent;case 5:if(!t.t0){t.next=7;break}return t.abrupt("return");case 7:if(""!=this.form.Telephone&&""!=this.form.Demand){t.next=10;break}return e.showToast({title:"请填写完整信息",icon:"none"}),t.abrupt("return");case 10:return this.uploading=!0,this.uploadedCount=0,t.prev=12,t.next=15,Promise.all(this.imageList.map((function(e,t){return 100===e.progress?Promise.resolve():r.uploadSingleImage(e,t)})));case 15:e.showToast({title:"上传完成"}),n=this.imageList.map((function(e){return{url:"".concat(r.qiniuDomain,"/").concat(e.key)}})),this.form.Images=n.map((function(e){return e.url})),this.submitFeedback(this.form),t.next=24;break;case 21:t.prev=21,t.t1=t["catch"](12),e.showToast({title:"上传出错",icon:"none"});case 24:return t.prev=24,this.uploading=!1,t.finish(24);case 27:case"end":return t.stop()}}),t,this,[[12,21,24,27]])}))),1e3),uploadSingleImage:function(t,n){var r=this;return new Promise((function(a,o){var i="ims/dev/feedback/".concat(r.HotelID,"/").concat(Date.now(),".").concat(t.tempPath.split(".").pop()),s=e.uploadFile({url:"https://up-z1.qiniup.com",filePath:t.tempPath,name:"file",formData:{token:r.qiniuToken,key:i,"x:isPublic":"1"},success:function(e){var t=JSON.parse(e.data);r.imageList[n].key=t.key,r.imageList[n].progress=100,r.uploadedCount++,a(t)},fail:function(e){console.error("图片".concat(n,"上传失败:"),e),o(e)}});s.onProgressUpdate=function(e){r.imageList[n].progress=e.progress,r.$forceUpdate()}}))},submitFeedback:function(t){var n=this;return(0,s.default)(o.default.mark((function r(){return o.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,(0,c.addAppFeedback)(t).then((function(t){t.ErrorMsg?e.showToast({title:t.ErrorMsg,icon:"none"}):(e.showToast({title:"提交成功",icon:"success"}),n.imageList=[],n.form.Demand="",n.form.Telephone="",setTimeout((function(){e.navigateTo({url:"/subpackageB/myFeedback"})}),200))}));case 2:case"end":return r.stop()}}),r)})))()}},mounted:function(){this.HotelID=e.getStorageSync("user_info").Hotel.ID}};t.default=l}).call(this,n(2)["default"],n(1)["default"])},299:function(e,t,n){"use strict";n.r(t);var r=n(300),a=n.n(r);for(var o in r)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(o);t["default"]=a.a},300:function(e,t,n){}},[[293,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../.sourcemap/mp-weixin/subpackageB/feedback.js.map