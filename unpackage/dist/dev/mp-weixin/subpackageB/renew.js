require('./common/vendor.js');(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["subpackageB/renew"],{285:function(e,n,t){"use strict";(function(e,n){var o=t(4);t(26);o(t(25));var r=o(t(286));e.__webpack_require_UNI_MP_PLUGIN__=t,n(r.default)}).call(this,t(1)["default"],t(2)["createPage"])},286:function(e,n,t){"use strict";t.r(n);var o=t(287),r=t(289);for(var c in r)["default"].indexOf(c)<0&&function(e){t.d(n,e,(function(){return r[e]}))}(c);t(291);var a,i=t(32),u=Object(i["default"])(r["default"],o["render"],o["staticRenderFns"],!1,null,"34af35c8",null,!1,o["components"],a);u.options.__file="subpackageB/renew.vue",n["default"]=u.exports},287:function(e,n,t){"use strict";t.r(n);var o=t(288);t.d(n,"render",(function(){return o["render"]})),t.d(n,"staticRenderFns",(function(){return o["staticRenderFns"]})),t.d(n,"recyclableRender",(function(){return o["recyclableRender"]})),t.d(n,"components",(function(){return o["components"]}))},288:function(e,n,t){"use strict";var o;t.r(n),t.d(n,"render",(function(){return r})),t.d(n,"staticRenderFns",(function(){return a})),t.d(n,"recyclableRender",(function(){return c})),t.d(n,"components",(function(){return o}));try{o={uniPopup:function(){return t.e("uni_modules/uni-popup/components/uni-popup/uni-popup").then(t.bind(null,345))},uniIcons:function(){return Promise.all([t.e("common/vendor"),t.e("uni_modules/uni-icons/components/uni-icons/uni-icons")]).then(t.bind(null,360))}}}catch(i){if(-1===i.message.indexOf("Cannot find module")||-1===i.message.indexOf(".vue"))throw i;console.error(i.message),console.error("1. 排查组件名称拼写是否正确"),console.error("2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom"),console.error("3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件")}var r=function(){var e=this,n=e.$createElement,t=(e._self._c,e.couponList.length);e.$mp.data=Object.assign({},{$root:{g0:t}})},c=!1,a=[];r._withStripped=!0},289:function(e,n,t){"use strict";t.r(n);var o=t(290),r=t.n(o);for(var c in o)["default"].indexOf(c)<0&&function(e){t.d(n,e,(function(){return o[e]}))}(c);n["default"]=r.a},290:function(e,n,t){"use strict";(function(e,o){var r=t(4);Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var c=r(t(43)),a=r(t(45)),i=r(t(13)),u=t(46),s=function(){Promise.all([t.e("common/vendor"),t.e("subpackageB/components/commonHeader")]).then(function(){return resolve(t(465))}.bind(null,t)).catch(t.oe)},l={components:{commonHeader:s},data:function(){return{planData:0,packages:[],availableCoupons:[],selectedPackage:0,selectedCoupons:[],loading:!1,packageList:[],couponList:[],one:"",two:"",selectedIndex:0,coupon:0,finalPrice:0,currtPrice:0,PrimePlanID:null,CouponID:0,formData:{recipient:"",phone:"",address:""},selectedCoupon:0,show:!1}},computed:{},methods:{handleCouponClick:function(){this.$refs.popup.open()},contactCustomerService:function(){e.openCustomerServiceChat({extInfo:{url:"https://work.weixin.qq.com/kfid/kfc31c83ef5ca238ab7"},corpId:"ww00aa5bcecce5872d",success:function(e){console.log("客服打开成功",e)},fail:function(e){console.error("客服打开失败",e)}})},handlePackageChange:function(e){this.selectedPackage=e.detail.value},popupChange:function(e){this.show=e.show},selectCoupon:function(e){console.log(e,"item"),this.selectedCoupon=e,this.planData=e.Price,this.CouponID=this.couponList.find((function(n){return n.Price===e.Price})).ID,this.finalPrice=this.currtPrice-this.planData},closePopup:function(){this.$refs.popup.close()},confirmSelection:function(){this.closePopup()},handleCouponChange:function(e){console.log((0,i.default)(e.detail.value),"e.detail.value"),this.coupon=e.detail.value,this.CouponID=this.couponList.find((function(n){return n.Price===parseInt(e.detail.value)})).ID,this.finalPrice=this.currtPrice-this.coupon},getUserShopping:function(){var e=this;return(0,a.default)(c.default.mark((function n(){return c.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,(0,u.getUserShopping)().then((function(n){n.ErrorMsg?o.showToast({title:n.ErrorMsg,icon:"none"}):(e.couponList=n.Data,e.availableCoupons=n.Data)}));case 2:case"end":return n.stop()}}),n)})))()},getUserPrime:function(){var e=this;return(0,a.default)(c.default.mark((function n(){return c.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,(0,u.getUserPrime)().then((function(n){n.ErrorMsg?o.showToast({title:n.ErrorMsg,icon:"none"}):(e.packages=n.Data,e.packageList=n.Data)}));case 2:case"end":return n.stop()}}),n)})))()},handlePayment:function(){var e=this;return(0,a.default)(c.default.mark((function n(){var t,r,a;return c.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.prev=0,t=Math.round(100*e.finalPrice),r={PrimePlanID:e.PrimePlanID,CouponID:e.CouponID,PayMoney:t,ShoppingAddress:e.formData.address||"",ShoppingPhone:e.formData.phone||"",ShoppingUser:e.formData.recipient||""},n.next=5,(0,u.shoppingBuy)(r).then((function(e){if(!e.ErrorMsg)return console.log(e.Data,"支付参数"),e.Data;o.showToast({title:e.ErrorMsg,icon:"none"})}));case 5:if(a=n.sent,a){n.next=8;break}return n.abrupt("return");case 8:o.requestPayment({provider:"wxpay",timeStamp:a.TimeStamp,nonceStr:a.NonceStr,package:a.Package,signType:a.SignType,paySign:a.PaySign,success:function(n){console.log("支付成功:",n),o.showToast({title:"支付成功",icon:"success"}),console.log(n,"8888"),console.log(a,"999"),e.shoppingBuyCallback(a.BuyRecord.ID,a.BuyRecord.PrepayID,"SUCCESS")},fail:function(n){console.error("支付失败:",n),o.showToast({title:"支付失败",icon:"none"}),e.shoppingBuyCallback(a.BuyRecord.ID,a.BuyRecord.PrepayID,"CLOSED")}}),n.next=15;break;case 11:n.prev=11,n.t0=n["catch"](0),console.error("获取支付参数失败:",n.t0),o.showToast({title:"获取支付参数失败",icon:"none"});case 15:case"end":return n.stop()}}),n,null,[[0,11]])})))()},selectPackage:function(e,n,t){this.PrimePlanID=e,this.finalPrice=t-this.planData,this.selectedIndex=n,this.currtPrice=t},shoppingBuyCallback:function(e,n,t){return(0,a.default)(c.default.mark((function r(){var a;return c.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return console.log(e,n,t,"回调参数"),a={PrepayID:n,status:t},r.next=4,(0,u.shoppingBuyCallback)(a).then((function(e){e.ErrorMsg?(console.log(e.ErrorMsg,"回调失败"),o.showToast({title:e.ErrorMsg,icon:"none"})):o.showToast({title:"支付成功",icon:"success",duration:500,complete:function(){o.reLaunch({url:"/pages/user/user"})}})}));case 4:case"end":return r.stop()}}),r)})))()}},mounted:function(){var e=this;return(0,a.default)(c.default.mark((function n(){return c.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,e.getUserPrime();case 2:e.getUserShopping(),setTimeout((function(){e.selectPackage(e.packageList[0].ID,0,e.packageList[0].Price)}),100);case 4:case"end":return n.stop()}}),n)})))()}};n.default=l}).call(this,t(1)["default"],t(2)["default"])},291:function(e,n,t){"use strict";t.r(n);var o=t(292),r=t.n(o);for(var c in o)["default"].indexOf(c)<0&&function(e){t.d(n,e,(function(){return o[e]}))}(c);n["default"]=r.a},292:function(e,n,t){}},[[285,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../.sourcemap/mp-weixin/subpackageB/renew.js.map