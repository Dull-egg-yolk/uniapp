require('./common/vendor.js');(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["subpackageB/renew"],{285:function(e,n,t){"use strict";(function(e,n){var r=t(4);t(26);r(t(25));var o=r(t(286));e.__webpack_require_UNI_MP_PLUGIN__=t,n(o.default)}).call(this,t(1)["default"],t(2)["createPage"])},286:function(e,n,t){"use strict";t.r(n);var r=t(287),o=t(289);for(var a in o)["default"].indexOf(a)<0&&function(e){t.d(n,e,(function(){return o[e]}))}(a);t(291);var c,u=t(32),i=Object(u["default"])(o["default"],r["render"],r["staticRenderFns"],!1,null,"34af35c8",null,!1,r["components"],c);i.options.__file="subpackageB/renew.vue",n["default"]=i.exports},287:function(e,n,t){"use strict";t.r(n);var r=t(288);t.d(n,"render",(function(){return r["render"]})),t.d(n,"staticRenderFns",(function(){return r["staticRenderFns"]})),t.d(n,"recyclableRender",(function(){return r["recyclableRender"]})),t.d(n,"components",(function(){return r["components"]}))},288:function(e,n,t){"use strict";var r;t.r(n),t.d(n,"render",(function(){return o})),t.d(n,"staticRenderFns",(function(){return c})),t.d(n,"recyclableRender",(function(){return a})),t.d(n,"components",(function(){return r}));var o=function(){var e=this,n=e.$createElement;e._self._c},a=!1,c=[];o._withStripped=!0},289:function(e,n,t){"use strict";t.r(n);var r=t(290),o=t.n(r);for(var a in r)["default"].indexOf(a)<0&&function(e){t.d(n,e,(function(){return r[e]}))}(a);n["default"]=o.a},290:function(e,n,t){"use strict";(function(e,r){var o=t(4);Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var a=o(t(43)),c=o(t(45)),u=o(t(13)),i=t(46),s=function(){Promise.all([t.e("common/vendor"),t.e("subpackageB/components/commonHeader")]).then(function(){return resolve(t(465))}.bind(null,t)).catch(t.oe)},l={components:{commonHeader:s},data:function(){return{packages:[],availableCoupons:[],selectedPackage:0,selectedCoupons:[],loading:!1,packageList:[],couponList:[],one:"",two:"",selectedIndex:0,coupon:0,finalPrice:0,currtPrice:0,PrimePlanID:null,CouponID:0}},computed:{},methods:{contactCustomerService:function(){e.openCustomerServiceChat({extInfo:{url:"https://work.weixin.qq.com/kfid/kfc31c83ef5ca238ab7"},corpId:"ww00aa5bcecce5872d",success:function(e){console.log("客服打开成功",e)},fail:function(e){console.error("客服打开失败",e)}})},handlePackageChange:function(e){this.selectedPackage=e.detail.value},handleCouponChange:function(e){console.log((0,u.default)(e.detail.value),"e.detail.value"),this.coupon=e.detail.value,this.CouponID=this.couponList.find((function(n){return n.Price===parseInt(e.detail.value)})).ID,this.finalPrice=this.currtPrice-this.coupon},getUserShopping:function(){var e=this;return(0,c.default)(a.default.mark((function n(){return a.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,(0,i.getUserShopping)().then((function(n){n.ErrorMsg?r.showToast({title:n.ErrorMsg,icon:"none"}):(e.couponList=n.Data,e.availableCoupons=n.Data)}));case 2:case"end":return n.stop()}}),n)})))()},getUserPrime:function(){var e=this;return(0,c.default)(a.default.mark((function n(){return a.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,(0,i.getUserPrime)().then((function(n){n.ErrorMsg?r.showToast({title:n.ErrorMsg,icon:"none"}):(e.packages=n.Data,e.packageList=n.Data)}));case 2:case"end":return n.stop()}}),n)})))()},handlePayment:function(){var e=this;return(0,c.default)(a.default.mark((function n(){var t,o,c;return a.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.prev=0,t=Math.round(100*e.finalPrice),o={PrimePlanID:e.PrimePlanID,CouponID:e.CouponID,PayMoney:t},n.next=5,(0,i.shoppingBuy)(o).then((function(e){if(!e.ErrorMsg)return console.log(e.Data,"支付参数"),e.Data;r.showToast({title:e.ErrorMsg,icon:"none"})}));case 5:if(c=n.sent,c){n.next=8;break}return n.abrupt("return");case 8:r.requestPayment({provider:"wxpay",timeStamp:c.TimeStamp,nonceStr:c.NonceStr,package:c.Package,signType:c.SignType,paySign:c.PaySign,success:function(n){console.log("支付成功:",n),r.showToast({title:"支付成功",icon:"success"}),e.shoppingBuyCallback(c.BuyRecord.ID,c.PrepayID,"SUCCESS")},fail:function(n){console.error("支付失败:",n),r.showToast({title:"支付失败",icon:"none"}),e.shoppingBuyCallback(c.BuyRecord.ID,c.PrepayID,"CLOSED")}}),n.next=15;break;case 11:n.prev=11,n.t0=n["catch"](0),console.error("获取支付参数失败:",n.t0),r.showToast({title:"获取支付参数失败",icon:"none"});case 15:case"end":return n.stop()}}),n,null,[[0,11]])})))()},selectPackage:function(e,n,t){this.PrimePlanID=e,this.finalPrice=t-this.coupon,this.selectedIndex=n,this.currtPrice=t},shoppingBuyCallback:function(e,n,t){return(0,c.default)(a.default.mark((function e(){var o;return a.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return o={PrepayID:n,status:t},e.next=3,(0,i.shoppingBuyCallback)(o).then((function(e){e.ErrorMsg?(console.log(e.ErrorMsg,"回调失败"),r.showToast({title:e.ErrorMsg,icon:"none"})):r.showToast({title:"支付成功",icon:"success",duration:500,complete:function(){r.reLaunch({url:"/pages/user/user"})}})}));case 3:case"end":return e.stop()}}),e)})))()}},mounted:function(){var e=this;return(0,c.default)(a.default.mark((function n(){return a.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,e.getUserPrime();case 2:e.getUserShopping(),setTimeout((function(){e.selectPackage(e.packageList[0].ID,0,e.packageList[0].Price)}),100);case 4:case"end":return n.stop()}}),n)})))()}};n.default=l}).call(this,t(1)["default"],t(2)["default"])},291:function(e,n,t){"use strict";t.r(n);var r=t(292),o=t.n(r);for(var a in r)["default"].indexOf(a)<0&&function(e){t.d(n,e,(function(){return r[e]}))}(a);n["default"]=o.a},292:function(e,n,t){}},[[285,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../.sourcemap/mp-weixin/subpackageB/renew.js.map