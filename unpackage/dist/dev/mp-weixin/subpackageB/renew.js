require('./common/vendor.js');(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["subpackageB/renew"],{277:function(e,n,t){"use strict";(function(e,n){var r=t(4);t(26);r(t(25));var a=r(t(278));e.__webpack_require_UNI_MP_PLUGIN__=t,n(a.default)}).call(this,t(1)["default"],t(2)["createPage"])},278:function(e,n,t){"use strict";t.r(n);var r=t(279),a=t(281);for(var o in a)["default"].indexOf(o)<0&&function(e){t.d(n,e,(function(){return a[e]}))}(o);t(283);var c,u=t(32),i=Object(u["default"])(a["default"],r["render"],r["staticRenderFns"],!1,null,"34af35c8",null,!1,r["components"],c);i.options.__file="subpackageB/renew.vue",n["default"]=i.exports},279:function(e,n,t){"use strict";t.r(n);var r=t(280);t.d(n,"render",(function(){return r["render"]})),t.d(n,"staticRenderFns",(function(){return r["staticRenderFns"]})),t.d(n,"recyclableRender",(function(){return r["recyclableRender"]})),t.d(n,"components",(function(){return r["components"]}))},280:function(e,n,t){"use strict";var r;t.r(n),t.d(n,"render",(function(){return a})),t.d(n,"staticRenderFns",(function(){return c})),t.d(n,"recyclableRender",(function(){return o})),t.d(n,"components",(function(){return r}));var a=function(){var e=this,n=e.$createElement;e._self._c},o=!1,c=[];a._withStripped=!0},281:function(e,n,t){"use strict";t.r(n);var r=t(282),a=t.n(r);for(var o in r)["default"].indexOf(o)<0&&function(e){t.d(n,e,(function(){return r[e]}))}(o);n["default"]=a.a},282:function(e,n,t){"use strict";(function(e){var r=t(4);Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var a=r(t(43)),o=r(t(45)),c=t(46),u=function(){Promise.all([t.e("common/vendor"),t.e("subpackageB/components/commonHeader")]).then(function(){return resolve(t(457))}.bind(null,t)).catch(t.oe)},i={components:{commonHeader:u},data:function(){return{packages:[],availableCoupons:[],selectedPackage:0,selectedCoupons:[],loading:!1,packageList:[],couponList:[],one:"",two:"",selectedIndex:0,coupon:0,finalPrice:0,currtPrice:0,PrimePlanID:null,CouponID:0}},computed:{},methods:{handlePackageChange:function(e){this.selectedPackage=e.detail.value},handleCouponChange:function(e){this.coupon=e.detail.value,this.CouponID=this.couponList[e.detail.value].ID,this.finalPrice=this.currtPrice-this.coupon},getUserShopping:function(){var n=this;return(0,o.default)(a.default.mark((function t(){return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,(0,c.getUserShopping)().then((function(t){t.ErrorMsg?e.showToast({title:t.ErrorMsg,icon:"none"}):(n.couponList=t.Data,n.availableCoupons=t.Data)}));case 2:case"end":return t.stop()}}),t)})))()},getUserPrime:function(){var n=this;return(0,o.default)(a.default.mark((function t(){return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,(0,c.getUserPrime)().then((function(t){t.ErrorMsg?e.showToast({title:t.ErrorMsg,icon:"none"}):(n.packages=t.Data,n.packageList=t.Data)}));case 2:case"end":return t.stop()}}),t)})))()},handlePayment:function(){var n=this;return(0,o.default)(a.default.mark((function t(){var r,o;return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,r={PrimePlanID:n.PrimePlanID,CouponID:n.CouponID,PayMoney:n.finalPrice},t.next=4,(0,c.shoppingBuy)(r).then((function(n){if(!n.ErrorMsg)return console.log(n.Data,"支付参数"),n.Data;e.showToast({title:n.ErrorMsg,icon:"none"})}));case 4:o=t.sent,e.requestPayment({provider:"wxpay",timeStamp:o.TimeStamp,nonceStr:o.NonceStr,package:o.Package,signType:o.SignType,paySign:o.PaySign,success:function(t){console.log("支付成功:",t),e.showToast({title:"支付成功",icon:"success"}),n.shoppingBuyCallback(o.BuyRecord.ID,o.PrepayID,"SUCCESS")},fail:function(t){console.error("支付失败:",t),e.showToast({title:"支付失败",icon:"none"}),n.shoppingBuyCallback(o.BuyRecord.ID,o.PrepayID,"CLOSED")}}),t.next=12;break;case 8:t.prev=8,t.t0=t["catch"](0),console.error("获取支付参数失败:",t.t0),e.showToast({title:"获取支付参数失败",icon:"none"});case 12:case"end":return t.stop()}}),t,null,[[0,8]])})))()},selectPackage:function(e,n,t){this.PrimePlanID=e,this.finalPrice=t-this.coupon,this.selectedIndex=n,this.currtPrice=t},shoppingBuyCallback:function(n,t,r){return(0,o.default)(a.default.mark((function n(){var o;return a.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return o={PrepayID:t,status:r},n.next=3,(0,c.shoppingBuyCallback)(o).then((function(n){n.ErrorMsg?(console.log(n.ErrorMsg,"回调失败"),e.showToast({title:n.ErrorMsg,icon:"none"})):e.showToast({title:"支付成功",icon:"success",duration:500,complete:function(){e.reLaunch({url:"/pages/user/user"})}})}));case 3:case"end":return n.stop()}}),n)})))()}},mounted:function(){var e=this;return(0,o.default)(a.default.mark((function n(){return a.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,e.getUserPrime();case 2:e.getUserShopping(),setTimeout((function(){e.selectPackage(e.packageList[0].ID,0,e.packageList[0].Price)}),100);case 4:case"end":return n.stop()}}),n)})))()}};n.default=i}).call(this,t(2)["default"])},283:function(e,n,t){"use strict";t.r(n);var r=t(284),a=t.n(r);for(var o in r)["default"].indexOf(o)<0&&function(e){t.d(n,e,(function(){return r[e]}))}(o);n["default"]=a.a},284:function(e,n,t){}},[[277,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../.sourcemap/mp-weixin/subpackageB/renew.js.map