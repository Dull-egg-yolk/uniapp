{"version":3,"sources":["uni-app:///main.js","webpack:////Users/edy/Desktop/jiu/uniapp/subpackageB/renew.vue?d35c","webpack:////Users/edy/Desktop/jiu/uniapp/subpackageB/renew.vue?2c78","webpack:////Users/edy/Desktop/jiu/uniapp/subpackageB/renew.vue?a66a","webpack:////Users/edy/Desktop/jiu/uniapp/subpackageB/renew.vue?687a","uni-app:///subpackageB/renew.vue","webpack:////Users/edy/Desktop/jiu/uniapp/subpackageB/renew.vue?1647"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page","renderjs","component","options","__file","components","render","_vm","this","_h","$createElement","_self","_c","recyclableRender","staticRenderFns","_withStripped","commonHeader","data","packages","availableCoupons","selectedPackage","selectedCoupons","loading","packageList","couponList","one","two","selectedIndex","coupon","finalPrice","currtPrice","PrimePlanID","CouponID","computed","methods","handlePackageChange","handleCouponChange","getUserShopping","uni","title","icon","getUserPrime","handlePayment","params","PayMoney","console","paymentParams","provider","timeStamp","nonceStr","package","signType","paySign","success","fail","selectPackage","shoppingBuyCallback","PrepayID","status","duration","complete","url","mounted","setTimeout"],"mappings":"4IAAA,MAGA,aACA,YAFAA,EAAGC,kCAAoCC,EAGvCC,EAAWC,a,gFCLX,oIACIC,EADJ,QASIC,EAAY,qBACd,aACA,YACA,sBACA,EACA,KACA,WACA,MACA,EACA,gBACAD,GAGFC,EAAUC,QAAQC,OAAS,wBACZ,aAAAF,E,0CCvBf,uQ,iCCAA,IAAIG,EAAJ,0LACA,IAAIC,EAAS,WACX,IAAIC,EAAMC,KACNC,EAAKF,EAAIG,eACJH,EAAII,MAAMC,IAEjBC,GAAmB,EACnBC,EAAkB,GACtBR,EAAOS,eAAgB,G,iCCRvB,yHAAo0B,eAAG,G,qJCqDv0B,yKACA,CACAV,YACAW,gBAEAC,gBACA,OACAC,YACAC,oBACAC,kBACAC,mBACAC,WAGAC,eACAC,cACAC,OACAC,OACAC,gBACAC,SACAC,aACAC,aACAC,iBACAC,aAGAC,YAEAC,SAEAC,gCACA,qCAIAC,+BACA,2BACA,iDACA,6CAGAC,2BAAA,qJACA,yCACA,WACAC,aACAC,iBACAC,eAGA,oBACA,8BASA,0CAlBA,IAqBAC,wBAAA,qJACA,sCACA,WACAH,aACAC,iBACAC,eAGA,kBACA,yBAEA,0CAXA,IAaAE,yBAAA,4IAOA,OAPA,SAGAC,GACAZ,0BACAC,oBACAY,uBACA,UACA,sCACA,eAQA,OAFAC,2BAEA,OAPAP,aACAC,iBACAC,iBAOA,OAXAM,SAcAR,kBACAS,iBACAC,sBACAC,oBACAC,kBACAC,oBACAC,kBACAC,oBACAR,uBACAP,aACAC,aACAC,iBAEA,4DAEAc,iBACAT,yBACAP,aACAC,aACAC,cAEA,6DAEA,mDAEAK,gCACAP,aACAC,iBACAC,cACA,wDAnDA,IAuDAe,8BACA,mBACA,8BACA,qBACA,mBAEAC,oCAAA,+HAIA,OAHAb,GACAc,WACAC,UACA,UACA,8CACA,YACAb,+BACAP,aACAC,iBACAC,eAGAF,aACAC,aACAC,eACAmB,aACAC,oBACAtB,YACAuB,+BAKA,0CAxBA,KA2BAC,mBAAA,oJACA,wBACA,oBACAC,uBACA,gEACA,+CALA,KAOA,c,6DC/NA,yHAAmsC,eAAG,G","file":"subpackageB/renew.js","sourcesContent":["import 'uni-pages';\n// @ts-ignore\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './subpackageB/renew.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./renew.vue?vue&type=template&id=34af35c8&scoped=true&\"\nvar renderjs\nimport script from \"./renew.vue?vue&type=script&lang=js&\"\nexport * from \"./renew.vue?vue&type=script&lang=js&\"\nimport style0 from \"./renew.vue?vue&type=style&index=0&id=34af35c8&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"34af35c8\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"subpackageB/renew.vue\"\nexport default component.exports","export * from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--17-0!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./renew.vue?vue&type=template&id=34af35c8&scoped=true&\"","var components\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./renew.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./renew.vue?vue&type=script&lang=js&\"","<template>\n  <view class=\"renew-container\">\n    <!-- 用户信息区 -->\n    <common-header></common-header>\n <!-- 套餐选择 -->\n    <view class=\"member-packages\">\n      <view\n        v-for=\"(item, index) in packageList\"\n        :class=\"['package-item', selectedIndex === index ? 'active' : '']\"\n        :key=\"index\"\n        @click=\"selectPackage(item.ID, index, item.Price)\"\n      >\n        <view class=\"package-title\">{{ item.Name }}</view>\n        <text class=\"package-price\">¥{{ item.Price }}元</text>\n        <text class=\"package-unit\" v-if=\"item.Month !== -1\">/{{ item.Month}}月</text>\n      </view>\n    </view>\n    <!-- 会员套餐区 -->\n   \n    <!-- 优惠信息区 -->\n    <view class=\"discount-info\">\n      <view class=\"discount-item-two\">\n        <text>请选择优惠券</text>\n        <radio-group @change=\"handleCouponChange\" class=\"coupon-group\">\n          <view class=\"package-item-two\" v-for=\"item in couponList\" :key=\"item.ID\">\n            <label>\n              <radio :value=\"item.Price\" :checked=\"selectedPackage === item.ID\" />\n              <text style=\"margin-right: 10rpx; width: 200rpx;\">{{ item.Note }} </text>\n              <text> ¥{{ item.Price }}</text>\n            </label>\n          </view>\n        </radio-group>\n        <!-- <text>{{ coupon }}</text> -->\n      </view>\n      <view class=\"discount-item\">\n        <text>实际支付（已优惠 {{coupon}} 元）</text>\n        <text class=\"final-price\">{{ finalPrice }}元</text>\n      </view>\n    </view>\n\n    <!-- 联系客服 -->\n    <view class=\"contact-customer\">\n      <button open-type=\"contact\" class=\"contact-btn\">\n        <text class=\"function-text\">如有疑问，请联系客服 ></text>\n      </button>\n    </view>\n\n    <!-- 付款按钮 -->\n    <button class=\"pay-btn\" @click=\"handlePayment\">付款</button>\n  </view>\n</template>\n<script>\nimport commonHeader from \"./components/commonHeader.vue\";\nimport { getUserPrime, getUserShopping, shoppingBuy, shoppingBuyCallback  } from \"@/api/user\";\nexport default {\n  components: {\n    commonHeader,\n  },\n  data() {\n    return {\n      packages: [], // 套餐列表\n      availableCoupons: [], // 可用优惠券列表\n      selectedPackage: 0, // 选中的套餐ID\n      selectedCoupons: [], // 选中的优惠券ID数组\n      loading: false, // 加载状态\n      //将data文件夹中的数据读入\n      // 套餐数据\n      packageList: [],\n      couponList: [],\n      one: '',\n      two: '',\n      selectedIndex: 0, // 选中的套餐索引\n      coupon: 0, // 优惠券\n      finalPrice: 0, // 初始实际支付价格\n      currtPrice: 0, // 当前套餐价格\n      PrimePlanID: null,\n      CouponID: 0,\n    };\n  },\n  computed: {\n  },\n  methods: {\n    // 套餐选择变化\n    handlePackageChange(e) {\n      this.selectedPackage = e.detail.value\n    },\n    \n    // 优惠券选择变化\n    handleCouponChange(e) {\n      this.coupon = e.detail.value\n      this.CouponID = this.couponList[e.detail.value].ID;\n      this.finalPrice = this.currtPrice - this.coupon\n    },\n    // 获取优惠券\n    async getUserShopping(){\n      await getUserShopping().then((res)=>{\n        if (res.ErrorMsg) {\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: res.ErrorMsg,\n\t\t\t\t\t\ticon: \"none\"\n\t\t\t\t\t});\n\t\t\t\t} else {\n          this.couponList = res.Data\n          this.availableCoupons = res.Data\n          // this.couponList.map(item => {\n          //   if (item.ID == id){\n          //     this.two = item.Price\n          //   } else {\n          //     this.two = 0\n          //   }\n          // });\n\t\t\t\t}\n      })\n    },\n    // 获取会员套餐\n    async getUserPrime(){\n      await getUserPrime().then((res)=>{\n        if (res.ErrorMsg) {\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: res.ErrorMsg,\n\t\t\t\t\t\ticon: \"none\"\n\t\t\t\t\t});\n\t\t\t\t} else {\n          this.packages = res.Data\n\t\t\t\t\tthis.packageList = res.Data\n\t\t\t\t}\n      })\n    },\n    async handlePayment() {\n      try {\n        // 调用后端接口获取支付参数\n        const params = {\n          PrimePlanID: this.PrimePlanID,\n          CouponID: this.CouponID,\n          PayMoney: this.finalPrice\n        }\n        const paymentParams = await shoppingBuy(params).then((res) => {\n          if (res.ErrorMsg) {\n            uni.showToast({\n              title: res.ErrorMsg,\n              icon: \"none\",\n            });\n          } else {\n            console.log(res.Data, '支付参数');\n            \n            return res.Data;\n          }\n        })\n\n        // 调用微信支付\n        uni.requestPayment({\n          provider: \"wxpay\",\n          timeStamp: paymentParams.TimeStamp, // 微信支付时间戳\n          nonceStr: paymentParams.NonceStr, // 微信支付随机字符串\n          package: paymentParams.Package, // 微信支付包名\n          signType: paymentParams.SignType, // 微信支付签名方式\n          paySign: paymentParams.PaySign, // 微信支付签名\n          success: (res) => {\n            console.log(\"支付成功:\", res);\n            uni.showToast({\n              title: \"支付成功\",\n              icon: \"success\",\n            });\n            this.shoppingBuyCallback(paymentParams.BuyRecord.ID, paymentParams.PrepayID, 'SUCCESS')\n          },\n          fail: (err) => {\n            console.error(\"支付失败:\", err);\n            uni.showToast({\n              title: \"支付失败\",\n              icon: \"none\",\n            });\n            this.shoppingBuyCallback(paymentParams.BuyRecord.ID, paymentParams.PrepayID, 'CLOSED')\n          },\n        });\n      } catch (err) {\n        console.error(\"获取支付参数失败:\", err);\n        uni.showToast({\n          title: \"获取支付参数失败\",\n          icon: \"none\",\n        });\n      }\n    },\n\n    selectPackage(id, index, price) {\n      this.PrimePlanID = id;\n      this.finalPrice = price - this.coupon;\n      this.selectedIndex = index;\n      this.currtPrice = price;\n    },\n    async shoppingBuyCallback(id, prepayId, status){\n      const params = {\n        PrepayID: prepayId,\n        status: status\n      }\n      await shoppingBuyCallback(params).then((res)=>{\n        if(res.ErrorMsg){\n          console.log(res.ErrorMsg, '回调失败');\n          uni.showToast({\n            title: res.ErrorMsg,\n            icon: \"none\"\n          });\n        } else {\n          uni.showToast({\n            title: '支付成功',\n            icon: 'success',\n            duration: 500,\n            complete: () => {\n              uni.reLaunch({\n                url: \"/pages/user/user\",\n              });\n            }\n          });\n        }\n      })\n    }\n  },\n  async mounted() {\n   await this.getUserPrime();\n    this.getUserShopping();\n    setTimeout(() => {\n      this.selectPackage(this.packageList[0].ID, 0, this.packageList[0].Price);\n    },100)\n  }\n};\n</script>\n\n<style scoped>\n.coupon-group {\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n  margin-left: 40rpx;\n}\n.section {\n  margin-bottom: 30rpx;\n  padding: 20rpx;\n  background-color: #fff;\n  border-radius: 10rpx;\n}\n\n.section-title {\n  font-size: 32rpx;\n  font-weight: bold;\n  margin-bottom: 20rpx;\n  display: block;\n}\n\n.package-item, .coupon-item {\n  padding: 20rpx 0;\n  border-bottom: 1rpx solid #f5f5f5;\n}\n\n.summary {\n  margin: 30rpx 0;\n  padding: 20rpx;\n  background-color: #fff;\n  border-radius: 10rpx;\n}\n\n.summary-item {\n  display: flex;\n  justify-content: space-between;\n  padding: 15rpx 0;\n}\n\n.summary-item.total {\n  font-weight: bold;\n  color: #e74c3c;\n  font-size: 36rpx;\n  border-top: 1rpx solid #f5f5f5;\n  margin-top: 10rpx;\n  padding-top: 20rpx;\n}\nwx-button:after {\n  border: none;\n}\n.function-text {\n  font-size: 28rpx;\n  color: #4F4F4F;\n}\n.renew-container {\n  background-color: #f5f5f5;\n  padding: 20rpx;\n  width: 100%;\n}\n\n.user-info {\n  display: flex;\n  align-items: center;\n  background-color: #fff;\n  border-radius: 10rpx;\n  padding: 20rpx;\n  margin-bottom: 20rpx;\n}\n.avatar {\n  width: 80rpx;\n  height: 80rpx;\n  border-radius: 50%;\n  margin-right: 20rpx;\n}\n.user-detail text {\n  display: block;\n  margin-bottom: 5rpx;\n  font-size: 28rpx;\n}\n.verified-icon {\n  display: inline-block;\n  width: 16rpx;\n  height: 16rpx;\n  /* background-image: url(\"认证图标地址\"); */\n  background-size: contain;\n  margin-left: 5rpx;\n}\n\n.member-packages {\n  display: flex;\n  justify-content: space-between;\n  margin-bottom: 20rpx;\n}\n.package-item {\n  text-align: center;\n  padding: 20rpx;\n  border: 1rpx solid #ddd;\n  border-radius: 8rpx;\n  background-color: #fff;\n  flex: 1;\n  margin-right: 10rpx;\n}\n.package-item-two {\n  text-align: center;\n  padding-bottom: 20rpx;\n}\n.package-item:last-child {\n  margin-right: 0;\n}\n.package-item.active {\n  border-color: #ff5722;\n  color: #ff5722;\n}\n.package-title {\n  font-size: 30rpx;\n  margin-bottom: 10rpx;\n}\n.package-price {\n  font-size: 26rpx;\n  color: #ff5722;\n}\n.package-unit {\n  font-size: 26rpx;\n}\n\n.discount-info {\n  background-color: #fff;\n  border-radius: 10rpx;\n  margin-bottom: 20rpx;\n}\n.discount-item {\n  padding: 20rpx;\n  border-bottom: 1rpx solid #f5f5f5;\n  display: flex;\n  justify-content: space-between;\n}\n.discount-item-two {\n  padding: 20rpx;\n  display: flex;\n}\n.discount-item:last-child {\n  border-bottom: none;\n}\n.final-price {\n  color: #ff5722;\n  font-weight: bold;\n}\n\n.contact-customer {\n  text-align: center;\n  margin: 20rpx 0;\n  color: #999;\n  font-size: 28rpx;\n}\n\n.pay-btn {\n  width: 100%;\n  padding: 20rpx;\n  background-color: #ff5722;\n  color: #fff;\n  border: none;\n  border-radius: 50rpx;\n  font-size: 32rpx;\n}\n</style>\n\n\n","import mod from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./renew.vue?vue&type=style&index=0&id=34af35c8&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./renew.vue?vue&type=style&index=0&id=34af35c8&scoped=true&lang=css&\""],"sourceRoot":""}